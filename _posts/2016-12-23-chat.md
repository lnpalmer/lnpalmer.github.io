---
layout: post
title: "Writing a simple chat server with socket.io"
excerpt: "Socket.io is an incredible JavaScript library for networking; by running it on node.js as a server, and in a web browser as a client, we can easily create a 'chat' application that allows for communication between several users."
---

[Socket.io](http://socket.io) is an incredible JavaScript library for high-performance networking; by running it on node.js as a server, and in a web browser as a client, we can easily create a 'chat' application that allows for communication between several users.

To get started, install [node.js](https://nodejs.org) on your machine and get the `socket.io` package. By default, node installs packages to your working directory, so make sure that you're in your project folder:

``` sh
$ npm install socket.io
```

You'll also want to install `express` for serving web pages:

``` sh
$ npm install express
```

We're going to use express to set up a small HTTP server, and use it to serve a single webpage which'll act as a frontend to our chat room. Some initial setup:

``` js
var express = require('express')();
var http = require('http').Server(express);
var io = require('socket.io')(http);
```

Express allows us to set the response to HTTP GET requests for various pages. We'll send a client HTML file for the root page, and provide a JavaScript file client.js to go along with it:

``` js
express.get('/', function(request, result) {
  result.sendFile(__dirname + '/client.html');
});
express.get('/client.js', function(request, result) {
  result.sendFile(__dirname + '/client.js');
});
```

We'll create these files later. For now, open the HTTP server on port 4444:

``` js
http.listen('4444', function() {
  console.log('listening for requests...');
});
```

Like just about everything in node, socket.io uses an event-based model to drive interaction. `io.on()` takes an event name as its first argument; the 'connection' event is fired when a socket.io client first connects to the server. The handler receives a socket object to represent the connection:

~~~ js
io.on('connection', function(socket) {
  // do something with the socket...
});
~~~

`socket.on()` will run a function every time the server receives an event from the client that socket represents. We can name events whatever we like; we'll have the socket receive 'chat' messages and echo them back to all the connected clients:

~~~ js
io.on('connection', function(socket) {
  socket.on('chat', function(message) {
    console.log('message received, content: ' + message);
    io.emit('chat', message);
  });
});
~~~

Now we need to shift to the client side. For `client.html`, use this:

~~~ html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="{{ site.url }}/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="{{ site.url }}/darkly.css">
    <title>{{ page.title }}</title>
</head>
<body>
  <nav class="navbar navbar-fixed-top navbar-full" style="background-color: #f8f8f8;">
    <span class="navbar-brand" style="color: #222;">
      <a href="http://lukasnpalmer.com" style="color: #222;">Lukas Palmer</a>
       /
      <a href="http://lnpalmer.github.io" style="color: #222;">Blog</a>
    </span>
  </nav>

  <br />
  <br />
  <br />

  <div class="container">
    <div class="row">
      <div class="col-md-2"></div>
      <div class="col-md-8">
        <h2>{{ page.title }}</h2>
        <hr />
        {{ content }}
        <br />
        <small class="text-muted">Generated {{ site.time }}</small>
      </div>
      <div class="col-md-2"></div>
    </div>
  </div>

  <script src="{{ site.url }}/bootstrap/js/bootstrap.min.js"></script>
</body>
</html>
~~~
